"""
  https://datalemur.com/questions/sql-bloomberg-stock-monthly-change

The Bloomberg terminal is the go-to resource for financial professionals, offering convenient access to a wide array of financial datasets. As a Data Analyst at Bloomberg, you have access to historical data on stock performance for the FAANG stocks.

Your task is to analyze the inter-month change in percentage for each FAANG stock by month over the years. This involves calculating the percentage change in closing price from one month to the next using the following formula:

Inter-month change in percentage = (Current month's closing price - Previous month's closing price) / Previous month's closing price x 100

For each FAANG stock, display the ticker symbol, the last day of the month, closing price, and the inter-month value change in percentage rounded to two decimal places for each stock. Ensure that the results are sorted by ticker symbol and date in chronological order.

stock_prices Schema:
Column Name	Type	Description
date	datetime	The specified date (mm/dd/yyyy) of the stock data.
ticker	varchar	The stock ticker symbol (e.g., AAPL) for the corresponding company.
open	decimal	The opening price of the stock at the start of the trading day.
high	decimal	The highest price reached by the stock during the trading day.
low	decimal	The lowest price reached by the stock during the trading day.
close	decimal	The closing price of the stock at the end of the trading day.
  
stock_prices Example Input:
Note that the table below displays randomly selected AAPL, AMZN, and GOOG data.

date	ticker	open	high	low	close
01/31/2020 00:00:00	AAPL	74.06	81.96	73.19	77.38
02/29/2020 00:00:00	AAPL	76.07	81.81	64.09	68.34
03/31/2020 00:00:00	AAPL	70.57	76.00	53.15	63.57
01/31/2020 00:00:00	AMZN	93.75	102.79	90.77	100.44
02/29/2020 00:00:00	AMZN	100.53	109.30	90.56	94.19
03/31/2020 00:00:00	AMZN	95.32	99.82	81.30	97.49
01/31/2020 00:00:00	GOOG	67.08	75.16	67.08	71.71
02/29/2020 00:00:00	GOOG	73.10	76.61	63.55	66.97
03/31/2020 00:00:00	GOOG	67.58	70.51	50.68	58.14
  
Example Output:
ticker	date	close	intermth_change_pct
AAPL	01/31/2020 00:00:00	77.38	NULL
AAPL	02/29/2020 00:00:00	68.34	-11.68
AAPL	03/31/2020 00:00:00	63.57	-6.98
AMZN	01/31/2020 00:00:00	100.44	NULL
AMZN	02/29/2020 00:00:00	94.19	-6.22
AMZN	03/31/2020 00:00:00	97.49	3.50
GOOG	01/31/2020 00:00:00	71.71	NULL
GOOG	02/29/2020 00:00:00	66.97	-6.61
GOOG	03/31/2020 00:00:00	58.14	-13.19
AAPL (Apple Inc.): Decrease in Feb 2020 (-11.68%) followed by a smaller increase in Mar 2020 (-6.98%).
AMZN (Amazon.com Inc.): Decrease in Feb 2020 (-6.22%), but an increase in Mar 2020 (3.50%).
GOOG (Alphabet Inc.): Similar pattern to AAPL with a drop in Feb 2020 (-6.61%) followed by a notable plunge in Mar 2020 (-13.19%).
The dataset you are querying against may have different input & output - this is just an example!
"""
with cte as (
select 
  ticker,
  date,
  close as "current_close",
  lag(close) over (partition by ticker order by date
  rows between unbounded preceding and current row) as "previous_close"
  from stock_prices)
  select 
  ticker,
  date,
  current_close as "close",
  round((current_close - previous_close)/previous_close * 100,2) as intermth_change_pct
  from cte 
  order by ticker,date;
"""
  ticker	date	close	intermth_change_pct
AAPL	01/31/2020 00:00:00	77.38	NULL
AAPL	02/29/2020 00:00:00	68.34	-11.68
AAPL	03/31/2020 00:00:00	63.57	-6.98
AAPL	04/30/2020 00:00:00	73.45	15.54
AAPL	05/31/2020 00:00:00	79.49	8.22
AAPL	06/30/2020 00:00:00	91.20	14.73
AAPL	07/31/2020 00:00:00	106.26	16.51
AAPL	08/31/2020 00:00:00	129.04	21.44
AAPL	09/30/2020 00:00:00	115.81	-10.25
AAPL	10/31/2020 00:00:00	108.86	-6.00
AAPL	11/30/2020 00:00:00	119.05	9.36
AAPL	12/31/2020 00:00:00	132.69	11.46
AAPL	01/31/2021 00:00:00	131.96	-0.55
AAPL	02/28/2021 00:00:00	121.26	-8.11
AAPL	03/31/2021 00:00:00	122.15	0.73
AAPL	04/30/2021 00:00:00	131.46	7.62
AAPL	05/31/2021 00:00:00	124.61	-5.21
AAPL	06/30/2021 00:00:00	136.96	9.91
AAPL	07/31/2021 00:00:00	145.86	6.50
AAPL	08/31/2021 00:00:00	151.83	4.09
AAPL	09/30/2021 00:00:00	141.50	-6.80
AAPL	10/31/2021 00:00:00	149.80	5.87
AAPL	11/30/2021 00:00:00	165.30	10.35
AAPL	12/31/2021 00:00:00	177.57	7.42
AAPL	01/31/2022 00:00:00	174.78	-1.57
AAPL	02/28/2022 00:00:00	165.12	-5.53
AAPL	03/31/2022 00:00:00	174.61	5.75
AAPL	04/30/2022 00:00:00	157.65	-9.71
AAPL	05/31/2022 00:00:00	148.84	-5.59
AAPL	06/30/2022 00:00:00	136.72	-8.14
AAPL	07/31/2022 00:00:00	162.51	18.86
AAPL	08/31/2022 00:00:00	157.22	-3.26
AAPL	09/30/2022 00:00:00	138.20	-12.10
AAPL	10/31/2022 00:00:00	153.34	10.96
AAPL	11/30/2022 00:00:00	148.03	-3.46
AAPL	12/31/2022 00:00:00	129.93	-12.23
AAPL	01/31/2023 00:00:00	144.29	11.05
AAPL	02/28/2023 00:00:00	147.41	2.16
AAPL	03/31/2023 00:00:00	164.90	11.86
AAPL	04/30/2023 00:00:00	169.68	2.90
AAPL	05/31/2023 00:00:00	177.25	4.46
AAPL	06/30/2023 00:00:00	193.97	9.43
AAPL	07/31/2023 00:00:00	196.45	1.28
AAPL	08/31/2023 00:00:00	187.87	-4.37
AMZN	01/31/2020 00:00:00	100.44	NULL
AMZN	02/29/2020 00:00:00	94.19	-6.22
AMZN	03/31/2020 00:00:00	97.49	3.50
AMZN	04/30/2020 00:00:00	123.70	26.88
AMZN	05/31/2020 00:00:00	122.12	-1.28
AMZN	06/30/2020 00:00:00	137.94	12.95
AMZN	07/31/2020 00:00:00	158.23	14.71
AMZN	08/31/2020 00:00:00	172.55	9.05
AMZN	09/30/2020 00:00:00	157.44	-8.76
AMZN	10/31/2020 00:00:00	151.81	-3.58
AMZN	11/30/2020 00:00:00	158.40	4.34
AMZN	12/31/2020 00:00:00	162.85	2.81
AMZN	01/31/2021 00:00:00	160.31	-1.56
AMZN	02/28/2021 00:00:00	154.65	-3.53
AMZN	03/31/2021 00:00:00	154.70	0.03
AMZN	04/30/2021 00:00:00	173.37	12.07
AMZN	05/31/2021 00:00:00	161.15	-7.05
AMZN	06/30/2021 00:00:00	172.01	6.74
AMZN	07/31/2021 00:00:00	166.38	-3.27
AMZN	08/31/2021 00:00:00	173.54	4.30
AMZN	09/30/2021 00:00:00	164.25	-5.35
AMZN	10/31/2021 00:00:00	168.62	2.66
AMZN	11/30/2021 00:00:00	175.35	3.99
AMZN	12/31/2021 00:00:00	166.72	-4.92
AMZN	01/31/2022 00:00:00	149.57	-10.29
AMZN	02/28/2022 00:00:00	153.56	2.67
AMZN	03/31/2022 00:00:00	163.00	6.15
AMZN	04/30/2022 00:00:00	124.28	-23.75
AMZN	05/31/2022 00:00:00	120.21	-3.27
AMZN	06/30/2022 00:00:00	106.21	-11.65
AMZN	07/31/2022 00:00:00	134.95	27.06
AMZN	08/31/2022 00:00:00	126.77	-6.06
AMZN	09/30/2022 00:00:00	113.00	-10.86
AMZN	10/31/2022 00:00:00	102.44	-9.35
AMZN	11/30/2022 00:00:00	96.54	-5.76
AMZN	12/31/2022 00:00:00	84.00	-12.99
AMZN	01/31/2023 00:00:00	103.13	22.77
AMZN	02/28/2023 00:00:00	94.23	-8.63
AMZN	03/31/2023 00:00:00	103.29	9.61
AMZN	04/30/2023 00:00:00	105.45	2.09
AMZN	05/31/2023 00:00:00	120.58	14.35
AMZN	06/30/2023 00:00:00	130.36	8.11
AMZN	07/31/2023 00:00:00	133.68	2.55
AMZN	08/31/2023 00:00:00	140.57	5.15
GOOG	01/31/2020 00:00:00	71.71	NULL
GOOG	02/29/2020 00:00:00	66.97	-6.61
GOOG	03/31/2020 00:00:00	58.14	-13.19
GOOG	04/30/2020 00:00:00	67.43	15.98
GOOG	05/31/2020 00:00:00	71.45	5.96
GOOG	06/30/2020 00:00:00	70.68	-1.08
GOOG	07/31/2020 00:00:00	74.15	4.91
GOOG	08/31/2020 00:00:00	81.71	10.20
GOOG	09/30/2020 00:00:00	73.48	-10.07
GOOG	10/31/2020 00:00:00	81.05	10.30
GOOG	11/30/2020 00:00:00	88.04	8.62
GOOG	12/31/2020 00:00:00	87.59	-0.51
GOOG	01/31/2021 00:00:00	91.79	4.80
GOOG	02/28/2021 00:00:00	101.84	10.95
GOOG	03/31/2021 00:00:00	103.43	1.56
GOOG	04/30/2021 00:00:00	120.51	16.51
GOOG	05/31/2021 00:00:00	120.58	0.06
GOOG	06/30/2021 00:00:00	125.32	3.93
GOOG	07/31/2021 00:00:00	135.22	7.90
GOOG	08/31/2021 00:00:00	145.46	7.57
GOOG	09/30/2021 00:00:00	133.27	-8.38
GOOG	10/31/2021 00:00:00	148.27	11.26
GOOG	11/30/2021 00:00:00	142.45	-3.93
GOOG	12/31/2021 00:00:00	144.68	1.57
GOOG	01/31/2022 00:00:00	135.70	-6.21
GOOG	02/28/2022 00:00:00	134.89	-0.60
GOOG	03/31/2022 00:00:00	139.65	3.53
GOOG	04/30/2022 00:00:00	114.97	-17.67
GOOG	05/31/2022 00:00:00	114.04	-0.81
GOOG	06/30/2022 00:00:00	109.37	-4.10
GOOG	07/31/2022 00:00:00	116.64	6.65
GOOG	08/31/2022 00:00:00	109.15	-6.42
GOOG	09/30/2022 00:00:00	96.15	-11.91
GOOG	10/31/2022 00:00:00	94.66	-1.55
GOOG	11/30/2022 00:00:00	101.45	7.17
GOOG	12/31/2022 00:00:00	88.73	-12.54
GOOG	01/31/2023 00:00:00	99.87	12.55
GOOG	02/28/2023 00:00:00	90.30	-9.58
GOOG	03/31/2023 00:00:00	104.00	15.17
GOOG	04/30/2023 00:00:00	108.22	4.06
GOOG	05/31/2023 00:00:00	123.37	14.00
GOOG	06/30/2023 00:00:00	120.97	-1.95
GOOG	07/31/2023 00:00:00	133.11	10.04
GOOG	08/31/2023 00:00:00	130.17	-2.21
META	01/31/2020 00:00:00	201.91	NULL
META	02/29/2020 00:00:00	192.47	-4.68
META	03/31/2020 00:00:00	166.80	-13.34
META	04/30/2020 00:00:00	204.71	22.73
META	05/31/2020 00:00:00	225.09	9.96
META	06/30/2020 00:00:00	227.07	0.88
META	07/31/2020 00:00:00	253.67	11.71
META	08/31/2020 00:00:00	293.20	15.58
META	09/30/2020 00:00:00	261.90	-10.68
META	10/31/2020 00:00:00	263.11	0.46
META	11/30/2020 00:00:00	276.97	5.27
META	12/31/2020 00:00:00	273.16	-1.38
META	01/31/2021 00:00:00	258.33	-5.43
META	02/28/2021 00:00:00	257.62	-0.27
META	03/31/2021 00:00:00	294.53	14.33
META	04/30/2021 00:00:00	325.08	10.37
META	05/31/2021 00:00:00	328.73	1.12
META	06/30/2021 00:00:00	347.71	5.77
META	07/31/2021 00:00:00	356.30	2.47
META	08/31/2021 00:00:00	379.38	6.48
META	09/30/2021 00:00:00	339.39	-10.54
META	10/31/2021 00:00:00	323.57	-4.66
META	11/30/2021 00:00:00	324.46	0.28
META	12/31/2021 00:00:00	336.35	3.66
META	01/31/2022 00:00:00	313.26	-6.86
META	02/28/2022 00:00:00	211.03	-32.63
META	03/31/2022 00:00:00	222.36	5.37
META	04/30/2022 00:00:00	200.47	-9.84
META	05/31/2022 00:00:00	193.64	-3.41
META	06/30/2022 00:00:00	161.25	-16.73
META	07/31/2022 00:00:00	159.10	-1.33
META	08/31/2022 00:00:00	162.93	2.41
META	09/30/2022 00:00:00	135.68	-16.72
META	10/31/2022 00:00:00	93.16	-31.34
META	11/30/2022 00:00:00	118.10	26.77
META	12/31/2022 00:00:00	120.34	1.90
META	01/31/2023 00:00:00	148.97	23.79
META	02/28/2023 00:00:00	174.94	17.43
META	03/31/2023 00:00:00	211.94	21.15
META	04/30/2023 00:00:00	240.32	13.39
META	05/31/2023 00:00:00	264.72	10.15
META	06/30/2023 00:00:00	286.98	8.41
META	07/31/2023 00:00:00	318.60	11.02
META	08/31/2023 00:00:00	302.69	-4.99
MSFT	01/31/2020 00:00:00	170.23	NULL
MSFT	02/29/2020 00:00:00	162.01	-4.83
MSFT	03/31/2020 00:00:00	157.71	-2.65
MSFT	04/30/2020 00:00:00	179.21	13.63
MSFT	05/31/2020 00:00:00	183.25	2.25
MSFT	06/30/2020 00:00:00	203.51	11.06
MSFT	07/31/2020 00:00:00	205.01	0.74
MSFT	08/31/2020 00:00:00	225.53	10.01
MSFT	09/30/2020 00:00:00	210.33	-6.74
MSFT	10/31/2020 00:00:00	202.47	-3.74
MSFT	11/30/2020 00:00:00	214.07	5.73
MSFT	12/31/2020 00:00:00	222.42	3.90
MSFT	01/31/2021 00:00:00	231.96	4.29
MSFT	02/28/2021 00:00:00	232.38	0.18
MSFT	03/31/2021 00:00:00	235.77	1.46
MSFT	04/30/2021 00:00:00	252.18	6.96
MSFT	05/31/2021 00:00:00	249.68	-0.99
MSFT	06/30/2021 00:00:00	270.90	8.50
MSFT	07/31/2021 00:00:00	284.91	5.17
MSFT	08/31/2021 00:00:00	301.88	5.96
MSFT	09/30/2021 00:00:00	281.92	-6.61
MSFT	10/31/2021 00:00:00	331.62	17.63
MSFT	11/30/2021 00:00:00	330.59	-0.31
MSFT	12/31/2021 00:00:00	336.32	1.73
MSFT	01/31/2022 00:00:00	310.98	-7.53
MSFT	02/28/2022 00:00:00	298.79	-3.92
MSFT	03/31/2022 00:00:00	308.31	3.19
MSFT	04/30/2022 00:00:00	277.52	-9.99
MSFT	05/31/2022 00:00:00	271.87	-2.04
MSFT	06/30/2022 00:00:00	256.83	-5.53
MSFT	07/31/2022 00:00:00	280.74	9.31
MSFT	08/31/2022 00:00:00	261.47	-6.86
MSFT	09/30/2022 00:00:00	232.90	-10.93
MSFT	10/31/2022 00:00:00	232.13	-0.33
MSFT	11/30/2022 00:00:00	255.14	9.91
MSFT	12/31/2022 00:00:00	239.82	-6.00
MSFT	01/31/2023 00:00:00	247.81	3.33
MSFT	02/28/2023 00:00:00	249.42	0.65
MSFT	03/31/2023 00:00:00	288.30	15.59
MSFT	04/30/2023 00:00:00	307.26	6.58
MSFT	05/31/2023 00:00:00	328.39	6.88
MSFT	06/30/2023 00:00:00	340.54	3.70
MSFT	07/31/2023 00:00:00	335.92	-1.36
MSFT	08/31/2023 00:00:00	324.04	-3.54
NFLX	01/31/2020 00:00:00	345.09	NULL
NFLX	02/29/2020 00:00:00	369.03	6.94
NFLX	03/31/2020 00:00:00	375.50	1.75
NFLX	04/30/2020 00:00:00	419.85	11.81
NFLX	05/31/2020 00:00:00	419.73	-0.03
NFLX	06/30/2020 00:00:00	455.04	8.41
NFLX	07/31/2020 00:00:00	488.88	7.44
NFLX	08/31/2020 00:00:00	529.56	8.32
NFLX	09/30/2020 00:00:00	500.03	-5.58
NFLX	10/31/2020 00:00:00	475.74	-4.86
NFLX	11/30/2020 00:00:00	490.70	3.14
NFLX	12/31/2020 00:00:00	540.73	10.20
NFLX	01/31/2021 00:00:00	532.39	-1.54
NFLX	02/28/2021 00:00:00	538.85	1.21
NFLX	03/31/2021 00:00:00	521.66	-3.19
NFLX	04/30/2021 00:00:00	513.47	-1.57
NFLX	05/31/2021 00:00:00	502.81	-2.08
NFLX	06/30/2021 00:00:00	528.21	5.05
NFLX	07/31/2021 00:00:00	517.57	-2.01
NFLX	08/31/2021 00:00:00	569.19	9.97
NFLX	09/30/2021 00:00:00	610.34	7.23
NFLX	10/31/2021 00:00:00	690.31	13.10
NFLX	11/30/2021 00:00:00	641.90	-7.01
NFLX	12/31/2021 00:00:00	602.44	-6.15
NFLX	01/31/2022 00:00:00	427.14	-29.10
NFLX	02/28/2022 00:00:00	394.52	-7.64
NFLX	03/31/2022 00:00:00	374.59	-5.05
NFLX	04/30/2022 00:00:00	190.36	-49.18
NFLX	05/31/2022 00:00:00	197.44	3.72
NFLX	06/30/2022 00:00:00	174.87	-11.43
NFLX	07/31/2022 00:00:00	224.90	28.61
NFLX	08/31/2022 00:00:00	223.56	-0.60
NFLX	09/30/2022 00:00:00	235.44	5.31
NFLX	10/31/2022 00:00:00	291.88	23.97
NFLX	11/30/2022 00:00:00	305.53	4.68
NFLX	12/31/2022 00:00:00	294.88	-3.49
NFLX	01/31/2023 00:00:00	353.86	20.00
NFLX	02/28/2023 00:00:00	322.13	-8.97
NFLX	03/31/2023 00:00:00	345.48	7.25
NFLX	04/30/2023 00:00:00	329.93	-4.50
NFLX	05/31/2023 00:00:00	395.23	19.79
NFLX	06/30/2023 00:00:00	440.49	11.45
NFLX	07/31/2023 00:00:00	438.97	-0.35
NFLX	08/31/2023 00:00:00	427.78	-2.55

"""
